(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{513:function(t,e,n){"use strict";n.r(e);n(41),n(238),n(63);var r=n(17),o=(n(78),n(167)),l=n.n(o),c={name:"AdminHome",middleware:"admin",data:function(){return{loading:"info",editLoading:!1,editDisabled:!0,editUserMenu:!1,editUser:null,snack:{show:!1,color:"success",text:"No info"},headers:[{text:"",sortable:!1},{text:"Name",value:"name"},{text:"Email",value:"email"},{text:"# of Logins",value:"logins_count"},{text:"Roles",sortable:!1},{text:"Last Login",value:"last_login"},{text:"Edit",sortable:!1,align:"center"}],users:[],roles:[],roleData:[]}},mounted:function(){this.refresh()},methods:{parseTime:function(time){return l()(time).format("MM/DD/YY h:mm a")},refresh:function(){var t=this;this.loading="info",this.users=[],this.roles=[],this.roleData=[],this.$api.get("/auth/users/all").then(function(e){e.data.forEach(function(u){u.roles=[]}),t.$api.get("/auth/roles/all").then(function(n){t.roleData=n.data,n.data.forEach(function(e){t.roles.push({text:e.name,value:e.id})}),t.asyncForEach(t.roles,function(){var n=Object(r.a)(regeneratorRuntime.mark(function n(r){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$api.get("/auth/roles/".concat(r.value,"/users"));case 2:n.sent.data.forEach(function(u){e.data.find(function(t){return t.user_id===u.user_id}).roles.push(r)});case 4:case"end":return n.stop()}},n)}));return function(t){return n.apply(this,arguments)}}()),t.loading=!1,t.users=e.data})})},editDialog:function(t){this.editUser=t,this.editUserMenu=!0},edit:function(){var t=this;this.editLoading=!0,this.$api.post("/auth/users/".concat(this.editUser.user_id,"/editroles"),{roles:this.editUser.roles}).then(function(e){t.snack.color="success",t.snack.text="Successfully updated users!"}).catch(function(){t.snack.color="error",t.snack.text="Something went wrong..."}).finally(function(){t.editLoading=!1,t.close(!1)})},close:function(t){t||(this.snack.show=!0),this.editUserMenu=!1,this.editUser=null,this.editDisabled=!0,t||this.refresh()}}},d=n(40),v=n(95),h=n.n(v),f=n(150),m=n(151),_=n(218),x=n(177),k=n(87),w=n(156),U=n(158),y=n(159),C=n(112),D=n(171),V=n(174),component=Object(d.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{row:"",wrap:"","justify-center":""}},[n("v-flex",{attrs:{xs12:"",xl8:""}},[n("v-card",{attrs:{color:"primary",dark:""}},[n("v-card-text",{staticClass:"headline text-xs-center"},[t._v("\n        Users\n      ")]),t._v(" "),n("v-card-text",[n("v-data-table",{staticClass:"ma-2",attrs:{headers:t.headers,items:t.users,loading:t.loading,"hide-actions":""},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("img",{staticClass:"d-block mx-auto",attrs:{src:e.item.picture,alt:"No Image",height:"50px"}})]),t._v(" "),n("td",[t._v(t._s(e.item.name))]),t._v(" "),n("td",[t._v(t._s(e.item.email))]),t._v(" "),n("td",[t._v(t._s(e.item.logins_count))]),t._v(" "),n("td",[t._v(t._s(e.item.roles.map(function(t){return t.text}).join(", ")))]),t._v(" "),n("td",[t._v(t._s(t.parseTime(e.item.last_login)))]),t._v(" "),n("td",{staticClass:"text-xs-center"},[n("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(r){var o=r.on;return[n("v-btn",t._g({attrs:{color:"primary",icon:""},on:{click:function(n){return t.editDialog(e.item)}}},o),[n("v-icon",{attrs:{color:"info"}},[t._v("\n                      edit\n                    ")])],1)]}}],null,!0)},[t._v("\n                Edit user's info\n                ")])],1)]}}])})],1)],1)],1),t._v(" "),t.editUser?n("v-dialog",{attrs:{"max-width":"500px",persistent:""},model:{value:t.editUserMenu,callback:function(e){t.editUserMenu=e},expression:"editUserMenu"}},[n("v-card",{attrs:{color:"primary",dark:""}},[n("v-card-text",{staticClass:"text-xs-center"},[n("span",{staticClass:"headline"},[t._v(t._s(t.editUser.name))]),n("br"),t._v(" "),n("span",{staticClass:"subtitle"},[t._v(t._s(t.editUser.email))])]),t._v(" "),n("v-card-text",[n("v-select",{attrs:{items:t.roles,label:"User Roles","hide-details":"","persistent-hint":"",multiple:"","small-chips":""},on:{change:function(e){t.editDisabled=!1}},model:{value:t.editUser.roles,callback:function(e){t.$set(t.editUser,"roles",e)},expression:"editUser.roles"}})],1),t._v(" "),n("v-card-actions",{staticClass:"justify-center"},[n("v-btn",{attrs:{color:"warning"},on:{click:function(e){return t.close(!0)}}},[t._v("\n          Cancel\n        ")]),t._v(" "),n("v-btn",{attrs:{color:"success",disabled:t.editDisabled,loading:t.editLoading},on:{click:t.edit}},[t._v("\n          Edit\n        ")])],1)],1)],1):t._e(),t._v(" "),n("v-snackbar",{attrs:{timeout:5e3,color:t.snack.color},model:{value:t.snack.show,callback:function(e){t.$set(t.snack,"show",e)},expression:"snack.show"}},[t._v("\n    "+t._s(t.snack.text)+"\n    "),n("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.snack.show=!1}}},[t._v("\n      Close\n    ")])],1)],1)},[],!1,null,null,null);e.default=component.exports;h()(component,{VBtn:f.a,VCard:m.a,VCardActions:_.b,VCardText:_.d,VDataTable:x.a,VDialog:k.a,VFlex:w.a,VIcon:U.a,VLayout:y.a,VSelect:C.a,VSnackbar:D.a,VTooltip:V.a})}}]);